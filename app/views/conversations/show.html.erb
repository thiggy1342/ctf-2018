<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<script>
    function timedRefresh(timeoutPeriod) {
        setTimeout('window.location.href=window.location.pathname+"?"+"content="+document.getElementById(\'message_content\').value;', timeoutPeriod);
        location.reload(true);
    }
    window.onload = timedRefresh(30000);
</script>

<div class="container">
  <h1>MysteryRandoChat.io</h1>
  <h2>Conversation with <%= @conversation.user1 %></h2>

  <div class="row">
    <div class="col-lg">
      <% if @conversation.messages %>
        <h3>Message History</h3>
        <% @conversation.messages.each do |message| %>
          <% if message[:from] == "Anon" %>
            <strong style="color:blue"> From <%= message[:from] %> to Me</strong><br>
          <% else %>
            <strong style="color:red"> From Me to <%= message[:to] %></strong><br>
          <% end %>
          <% if @conversation[:display_html?] %>
            <%= raw message.content %><br>
          <% else %>
            <%= message.content %><br>
          <% end %>
          <br>
        <% end %>
      <% end %>
    </div>
    <div class="col-2">
      <div class="row">
        <%= button_to "Clear Message History", conversation_clear_history_path(@conversation) %>
      </div>
      <div class="row">
        <%= button_to "Enable/Disable Embedded Images", conversation_display_elements_path(@conversation) %>
      </div>
    </div>
  </div>

  <div class="row">
    <h3>Send New Message</h3>
  </div>
  <div class="row">
    <%= form_with(model: [ @conversation, @conversation.messages.build ], local: true) do |form| %>
      <p>
        <%= form.hidden_field :to, value: @conversation[:user1] %>
        <%= form.hidden_field :from, value: @conversation[:user2] %>
        <%= form.hidden_field :user_generated, value: true %>
        <%= form.text_area :content , value: params[:content], rows: 10, cols: 100, class: "col-lg-auto",style: "min-width: 100%" %><br>
        <%= form.submit %>
      </p>
    <% end %>
  </div>
  <div class="row">
    <p style="color:red;"><strong>Note: </strong>Due to the extremely secure design of this service, it may take up to a minute for messages to be delivered.</p>
  </div>

</div>
